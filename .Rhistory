keep<-grep(ICD_Filtered[i,1],train$Diag1)
keepall<-keep+keepall
}
train<-train[keep,]
#Filters out unnecessary columns
train <-df %>% select(
-Type_Bill,
-Fed_Tax_SubID,
-Fed_Tax_Num,
-Admission_Type,
-Admission_Source,
-Do_Not_Resuscitate,
-Accident_St,
-starts_with("Units_Service"), #[1:18]
-Primary_Health_Plan_Id,
-Secondary_Health_Plan_Id,
-Tertiary_Health_Plan_Id,
-Primary_Patient_Rel_Insr,
-Secondary_Patient_Rel_Insr,
-Tertiary_Patient_Rel_Insr,
-Dx_Px_Qualifier,
-starts_with("POA"), #[1:18]
-starts_with("Patient_Reason_Visit"),#[1:3],
-Prospect_Pay_Code,
-starts_with("Ecode"), #[1:3]
-starts_with("E_POA"), #[1:3]
-Type_ER_Visit,
-Outcome_ER_Visit,
-Inpatient_Flag,
-ER_Flag,
-PET_Flag,
-ASTC_Flag,
-Lithotripsy_Flag,
-MRI_MRA_Flag,
-Megavolt_Rad_Flag,
-CT_Flag,
-Fatal_Error_Flag,
-starts_with("Record_Num"), #[1:2]
-Bill_End,
-MUL,
-Patient_ID,
-TN_Co_Res,
-Payer_A,
-Payer_B,
-Payer_C,
-Amount_Counter,
-Race,
-LOS,
-DRG_Rank,
-Inpat_Record_Flag,
-ER_Record_Flag,
-ASTC_Record_Flag,
-Obs_23hr_Record_Flag,
-CON_Flag,
-Cumulative_Record_Flag,
-Reportable_Flag,
-TN_Co_Unk,
-Processing_Period,
-MS_MDC,
-MS_DRG,
-MS_DRG_4digit,
-HAC,
-Admit_From_ED_Flag,
-Wrong_Claim
)
keepall<-c()
for(i in 1:492){
keep<-grep(ICD_Filtered[i,1],train$Diag1)
keepall<-keep+keepall
}
train<-train[keep,]
View(train)
keep<-grep(ICD_Filtered[i,1],train$Diag1)
#Filters out unnecessary columns
train <-df %>% select(
-Type_Bill,
-Fed_Tax_SubID,
-Fed_Tax_Num,
-Admission_Type,
-Admission_Source,
-Do_Not_Resuscitate,
-Accident_St,
-starts_with("Units_Service"), #[1:18]
-Primary_Health_Plan_Id,
-Secondary_Health_Plan_Id,
-Tertiary_Health_Plan_Id,
-Primary_Patient_Rel_Insr,
-Secondary_Patient_Rel_Insr,
-Tertiary_Patient_Rel_Insr,
-Dx_Px_Qualifier,
-starts_with("POA"), #[1:18]
-starts_with("Patient_Reason_Visit"),#[1:3],
-Prospect_Pay_Code,
-starts_with("Ecode"), #[1:3]
-starts_with("E_POA"), #[1:3]
-Type_ER_Visit,
-Outcome_ER_Visit,
-Inpatient_Flag,
-ER_Flag,
-PET_Flag,
-ASTC_Flag,
-Lithotripsy_Flag,
-MRI_MRA_Flag,
-Megavolt_Rad_Flag,
-CT_Flag,
-Fatal_Error_Flag,
-starts_with("Record_Num"), #[1:2]
-Bill_End,
-MUL,
-Patient_ID,
-TN_Co_Res,
-Payer_A,
-Payer_B,
-Payer_C,
-Amount_Counter,
-Race,
-LOS,
-DRG_Rank,
-Inpat_Record_Flag,
-ER_Record_Flag,
-ASTC_Record_Flag,
-Obs_23hr_Record_Flag,
-CON_Flag,
-Cumulative_Record_Flag,
-Reportable_Flag,
-TN_Co_Unk,
-Processing_Period,
-MS_MDC,
-MS_DRG,
-MS_DRG_4digit,
-HAC,
-Admit_From_ED_Flag,
-Wrong_Claim
)
keep<-grep(ICD_Filtered[i,1],train$Diag1)
keep<-grep(as.character(ICD_Filtered[i,1]),train$Diag1)
ICD_Filtered[1,1]
ICD_Filtered[2,1]
ICD_Filtered[3,1]
library(gsheet)
# Reading in doc of IDC10codes
codes<-gsheet2tbl("https://docs.google.com/document/d/1e53UDsuHZwQAyVc8vAG69Al_tjXbnv6C/edit?usp=sharing")
# Reading in doc of IDC10codes
codes<-gsheet2tbl("https://docs.google.com/document/d/1e53UDsuHZwQAyVc8vAG69Al_tjXbnv6C/edit")
# Reading in doc of IDC10codes
codes<-gsheet2tbl("https://docs.google.com/document/d/1e53UDsuHZwQAyVc8vAG69Al_tjXbnv6C/edit?usp=sharing&ouid=101883700449258151197&rtpof=true&sd=true")
# Reading in doc of IDC10codes
codes<-gsheet2tbl("C:\Users\alane\Downloads\Supplementary Tables 1 and 2.docx")
# Reading in doc of IDC10codes
codes<-gsheet2tbl("C:/Users/alane/Downloads/Supplementary Tables 1 and 2.docx")
# Reading in doc of IDC10codes
codes<-gsheet::gsheet2tbl("C:/Users/alane/Downloads/Supplementary Tables 1 and 2.docx")
# Reading in doc of IDC10codes
codes<-gsheet::gsheet2tbl("https://docs.google.com/document/d/1e53UDsuHZwQAyVc8vAG69Al_tjXbnv6C/edit")
install.packages("officer")
library(officer)
######################## Libraries and Data sets ####################
# June 23rd 2022 | Start of exploration and cleaning!
#####################################################################
library(tidyverse)
setwd("D:/DataLab/syndemic")
df <- read_csv("D:/DataLab/DataLab_2022/jacobzip.csv")
codes <- read_csv("codes.csv")
# Data set Formatting -----------------------------------------------
# Filters out unnecessary columns
train <-df %>% select(
-Type_Bill,
-Fed_Tax_SubID,
-Fed_Tax_Num,
-Admission_Type,
-Admission_Source,
-Do_Not_Resuscitate,
-Accident_St,
-starts_with("Units_Service"), #[1:18]
-Primary_Health_Plan_Id,
-Secondary_Health_Plan_Id,
-Tertiary_Health_Plan_Id,
-Primary_Patient_Rel_Insr,
-Secondary_Patient_Rel_Insr,
-Tertiary_Patient_Rel_Insr,
-Dx_Px_Qualifier,
-starts_with("POA"), #[1:18]
-starts_with("Patient_Reason_Visit"),#[1:3],
-Prospect_Pay_Code,
-starts_with("Ecode"), #[1:3]
-starts_with("E_POA"), #[1:3]
-Type_ER_Visit,
-Outcome_ER_Visit,
-Inpatient_Flag,
-ER_Flag,
-PET_Flag,
-ASTC_Flag,
-Lithotripsy_Flag,
-MRI_MRA_Flag,
-Megavolt_Rad_Flag,
-CT_Flag,
-Fatal_Error_Flag,
-starts_with("Record_Num"), #[1:2]
-Bill_End,
-MUL,
-Patient_ID,
-TN_Co_Res,
-Payer_A,
-Payer_B,
-Payer_C,
-Amount_Counter,
-Race,
-LOS,
-DRG_Rank,
-Inpat_Record_Flag,
-ER_Record_Flag,
-ASTC_Record_Flag,
-Obs_23hr_Record_Flag,
-CON_Flag,
-Cumulative_Record_Flag,
-Reportable_Flag,
-TN_Co_Unk,
-Processing_Period,
-MS_MDC,
-MS_DRG,
-MS_DRG_4digit,
-HAC,
-Admit_From_ED_Flag,
-Wrong_Claim
)
ke<-data.frame()
# New way of filtering data -----------------------------------------
# Selecting columns I want
trainnew<-df %>%
select( ...1,
Diag1:Diag18
)
trainnew<-trainnew %>% pivot_longer(starts_with("Diag"))
View(trainnew)
ke<-data.frame()
for( i in 1:107){
kp<-trainnew %>% filter(substr(value),1,nchar(codevector[i]) == as.character(codevector[i]))
ke<-rbind(ke,kp)
}
for( i in 1:107){
kp<-trainnew %>% filter(substr(value,1,nchar(codevector[i])) == as.character(codevector[i]))
ke<-rbind(ke,kp)
}
# creating vector of codes-------------------------------------------
codevector<-pull(codes , code)
ke<-data.frame()
for( i in 1:107){
kp<-trainnew %>% filter(substr(value,1,nchar(codevector[i])) == as.character(codevector[i]))
ke<-rbind(ke,kp)
}
View(ke)
View(codes)
ke<-data.frame()
ke<-trainnew %>% filter(substr(value,1,nchar(codevector[104])) == as.character(codevector[104]))
ke<-data.frame()
ke<-trainnew %>% filter(substr(value,1,nchar(codevector[83])) == as.character(codevector[83]))
# creating vector of codes-------------------------------------------
codevector<-pull(codes , code)
# creating empty collection to then fill
keepall<-c()
# For loop to go through each code and compare to diagnosis column to keep their row number
for(i in 1:107){
keep<-grep(codevector[i], train1$Diag1)
keepall<-c(keep, keepall)
}
#Combines all of the diagnosis into new variable column--------------
train1<-train
train1$Diag1 <- train$Diag1 %>%
paste(df$Diag1,
df$Diag2,
df$Diag3,
df$Diag4,
df$Diag5,
df$Diag6,
df$Diag7,
df$Diag8,
df$Diag9,
df$Diag10,
df$Diag11,
df$Diag12,
df$Diag13,
df$Diag14,
df$Diag15,
df$Diag16,
df$Diag17,
df$Diag18
)
# Gets rid of diagnosis columns because I combined it into one
train1<-train1 %>%
select(-Diag2,
-Diag3,
-Diag4,
-Diag5,
-Diag6,
-Diag7,
-Diag8,
-Diag9,
-Diag10,
-Diag11,
-Diag12,
-Diag13,
-Diag14,
-Diag15,
-Diag16,
-Diag17,
-Diag18
)
# creating vector of codes-------------------------------------------
codevector<-pull(codes , code)
# creating empty collection to then fill
keepall<-c()
# For loop to go through each code and compare to diagnosis column to keep their row number
for(i in 1:107){
keep<-grep(codevector[i], train1$Diag1)
keepall<-c(keep, keepall)
}
# Getting rid of repeating row numbers
keepall<-unique(keepall)
# Picking just the rows that mention any of the codes in our code collection.
filtered_df1<-train1[keepall,]
View(filtered_df1)
setwd("D:/DataLab/syndemic")
# Reading in doc of IDC10codes and creating codes csv----------------
icd<-read_csv("codes-Sheet1.csv", col_names = FALSE)
icd<-icd %>% mutate(code = substr(icd$X1,1 , 7 )) %>%mutate( astrid = ifelse(str_detect(icd$X1, "[*]"),TRUE,FALSE))
View(icd)
icd$code <- icd$code %>% str_replace_all("[.]","") %>% str_replace_all("[*]","")
# Only run once
write_csv(icd, "codes.csv")
codes <- read_csv("codes.csv")
View(codes)
######################## Libraries and Data sets ####################
# June 23rd 2022 | Start of exploration and cleaning!
#####################################################################
library(tidyverse)
setwd("D:/DataLab/syndemic")
df <- read_csv("D:/DataLab/DataLab_2022/jacobzip.csv")
codes <- read_csv("codes.csv")
# Data set Formatting -----------------------------------------------
# Filters out unnecessary columns
train <-df %>% select(
-Type_Bill,
-Fed_Tax_SubID,
-Fed_Tax_Num,
-Admission_Type,
-Admission_Source,
-Do_Not_Resuscitate,
-Accident_St,
-starts_with("Units_Service"), #[1:18]
-Primary_Health_Plan_Id,
-Secondary_Health_Plan_Id,
-Tertiary_Health_Plan_Id,
-Primary_Patient_Rel_Insr,
-Secondary_Patient_Rel_Insr,
-Tertiary_Patient_Rel_Insr,
-Dx_Px_Qualifier,
-starts_with("POA"), #[1:18]
-starts_with("Patient_Reason_Visit"),#[1:3],
-Prospect_Pay_Code,
-starts_with("Ecode"), #[1:3]
-starts_with("E_POA"), #[1:3]
-Type_ER_Visit,
-Outcome_ER_Visit,
-Inpatient_Flag,
-ER_Flag,
-PET_Flag,
-ASTC_Flag,
-Lithotripsy_Flag,
-MRI_MRA_Flag,
-Megavolt_Rad_Flag,
-CT_Flag,
-Fatal_Error_Flag,
-starts_with("Record_Num"), #[1:2]
-Bill_End,
-MUL,
-Patient_ID,
-TN_Co_Res,
-Payer_A,
-Payer_B,
-Payer_C,
-Amount_Counter,
-Race,
-LOS,
-DRG_Rank,
-Inpat_Record_Flag,
-ER_Record_Flag,
-ASTC_Record_Flag,
-Obs_23hr_Record_Flag,
-CON_Flag,
-Cumulative_Record_Flag,
-Reportable_Flag,
-TN_Co_Unk,
-Processing_Period,
-MS_MDC,
-MS_DRG,
-MS_DRG_4digit,
-HAC,
-Admit_From_ED_Flag,
-Wrong_Claim
)
#Combines all of the diagnosis into new variable column--------------
train1<-train
train1$Diag1 <- train$Diag1 %>%
paste(df$Diag1:df$Diag18)
train1$Diag1 <- train$Diag1 %>%
paste(df$Diag1:Diag18)
train1$Diag1 <- train$Diag1 %>%
paste(df$Diag1:df$Diag18)
train1$Diag1 <- train$Diag1 %>%
paste(df$Diag1,
df$Diag2,
df$Diag3,
df$Diag4,
df$Diag5,
df$Diag6,
df$Diag7,
df$Diag8,
df$Diag9,
df$Diag10,
df$Diag11,
df$Diag12,
df$Diag13,
df$Diag14,
df$Diag15,
df$Diag16,
df$Diag17,
df$Diag18
)
# Gets rid of diagnosis columns because I combined it into one
train1<-train1 %>%
select(-Diag2:Diag18)
View(train1)
# Gets rid of diagnosis columns because I combined it into one
train1<-train1 %>%
select(-Diag2:-Diag18)
#Combines all of the diagnosis into new variable column--------------
train1<-train
train1$Diag1 <- train$Diag1 %>%
paste(df$Diag1,
df$Diag2,
df$Diag3,
df$Diag4,
df$Diag5,
df$Diag6,
df$Diag7,
df$Diag8,
df$Diag9,
df$Diag10,
df$Diag11,
df$Diag12,
df$Diag13,
df$Diag14,
df$Diag15,
df$Diag16,
df$Diag17,
df$Diag18
)
# Gets rid of diagnosis columns because I combined it into one
train1<-train1 %>%
select(-Diag2:-Diag18)
View(train1)
swdf<-codes %>% filter(astrid)
View(swdf)
swv<-pull(codes,code)
fixeddf<-codes %>% filter(!astrid)
View(fixeddf)
swdf<-codes %>% filter(astrid)
swv<-pull(swdf,code)
fixeddf<-codes %>% filter(!astrid)
fixedv<-pull(fixeddf,code)
trainsw<-df %>%
select( ...1,
Diag1:Diag18
)
trainsw<-trainsw %>% pivot_longer(starts_with("Diag"))
View(trainsw)
ke<-data.frame()
ke<-data.frame()
for(i in 1:12){
kp<-trainnew %>% filter(substr(value,1,nchar(swv[i])) == as.character(swv[i]))
ke<-rbind(ke,kp)
}
for(i in 1:12){
kp<-trainsw %>% filter(substr(value,1,nchar(swv[i])) == as.character(swv[i]))
ke<-rbind(ke,kp)
}
print(swv)
View(trainsw)
View(ke)
swfinal<-trainsw %>% filter(substr(value,1,3) %in% swv )
View(swfinal)
trainpl<-df %>%
select( ...1,
Diag1:Diag18
)
trainpl<-trainpl %>% pivot_longer(starts_with("Diag"))
swfinal<-trainpl %>% filter(substr(value,1,3) %in% swv )
fixedfinal<-trainpl %>% filter(value %>% fixedv)
fixedfinal<-trainpl %>% filter(value %in% fixedv)
View(fixedfinal)
# Make the patient ids in vectors and join them
swidv<-pull(swfinal,...1)
ffidv<-pull(fixedfinal,...1)
fidv<-c(ffidv, swidv)
11047+3374
fidv<-unique(fidv)
14421-11382
cleands<-df %>% filter( ...1 %in% fidv)
View(cleands)
cleands<-train %>% filter( ...1 %in% fidv)
View(cleands)
fixedv
