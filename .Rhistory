-HAC,
-Admit_From_ED_Flag,
-Wrong_Claim
)
keepall<-c()
for(i in 1:492){
keep<-grep(ICD_Filtered[i,1],train$Diag1)
keepall<-keep+keepall
}
train<-train[keep,]
View(train)
keep<-grep(ICD_Filtered[i,1],train$Diag1)
#Filters out unnecessary columns
train <-df %>% select(
-Type_Bill,
-Fed_Tax_SubID,
-Fed_Tax_Num,
-Admission_Type,
-Admission_Source,
-Do_Not_Resuscitate,
-Accident_St,
-starts_with("Units_Service"), #[1:18]
-Primary_Health_Plan_Id,
-Secondary_Health_Plan_Id,
-Tertiary_Health_Plan_Id,
-Primary_Patient_Rel_Insr,
-Secondary_Patient_Rel_Insr,
-Tertiary_Patient_Rel_Insr,
-Dx_Px_Qualifier,
-starts_with("POA"), #[1:18]
-starts_with("Patient_Reason_Visit"),#[1:3],
-Prospect_Pay_Code,
-starts_with("Ecode"), #[1:3]
-starts_with("E_POA"), #[1:3]
-Type_ER_Visit,
-Outcome_ER_Visit,
-Inpatient_Flag,
-ER_Flag,
-PET_Flag,
-ASTC_Flag,
-Lithotripsy_Flag,
-MRI_MRA_Flag,
-Megavolt_Rad_Flag,
-CT_Flag,
-Fatal_Error_Flag,
-starts_with("Record_Num"), #[1:2]
-Bill_End,
-MUL,
-Patient_ID,
-TN_Co_Res,
-Payer_A,
-Payer_B,
-Payer_C,
-Amount_Counter,
-Race,
-LOS,
-DRG_Rank,
-Inpat_Record_Flag,
-ER_Record_Flag,
-ASTC_Record_Flag,
-Obs_23hr_Record_Flag,
-CON_Flag,
-Cumulative_Record_Flag,
-Reportable_Flag,
-TN_Co_Unk,
-Processing_Period,
-MS_MDC,
-MS_DRG,
-MS_DRG_4digit,
-HAC,
-Admit_From_ED_Flag,
-Wrong_Claim
)
keep<-grep(ICD_Filtered[i,1],train$Diag1)
keep<-grep(as.character(ICD_Filtered[i,1]),train$Diag1)
ICD_Filtered[1,1]
ICD_Filtered[2,1]
ICD_Filtered[3,1]
library(gsheet)
# Reading in doc of IDC10codes
codes<-gsheet2tbl("https://docs.google.com/document/d/1e53UDsuHZwQAyVc8vAG69Al_tjXbnv6C/edit?usp=sharing")
# Reading in doc of IDC10codes
codes<-gsheet2tbl("https://docs.google.com/document/d/1e53UDsuHZwQAyVc8vAG69Al_tjXbnv6C/edit")
# Reading in doc of IDC10codes
codes<-gsheet2tbl("https://docs.google.com/document/d/1e53UDsuHZwQAyVc8vAG69Al_tjXbnv6C/edit?usp=sharing&ouid=101883700449258151197&rtpof=true&sd=true")
# Reading in doc of IDC10codes
codes<-gsheet2tbl("C:\Users\alane\Downloads\Supplementary Tables 1 and 2.docx")
# Reading in doc of IDC10codes
codes<-gsheet2tbl("C:/Users/alane/Downloads/Supplementary Tables 1 and 2.docx")
# Reading in doc of IDC10codes
codes<-gsheet::gsheet2tbl("C:/Users/alane/Downloads/Supplementary Tables 1 and 2.docx")
# Reading in doc of IDC10codes
codes<-gsheet::gsheet2tbl("https://docs.google.com/document/d/1e53UDsuHZwQAyVc8vAG69Al_tjXbnv6C/edit")
install.packages("officer")
library(officer)
library(ggsheet)
library(gsheet)
# Possibly useful code but not the most important--------------------
#####################################################################
# Reading in doc of IDC10codes and creating codes csv----------------
icd<-gsheet::gsheet2tbl("https://docs.google.com/spreadsheets/d/1hrniE4MIjZKVABg2DMR_tnKOt-SuIdPXYkzszWjQqbA/edit#gid=0")
View(icd)
# Possibly useful code but not the most important--------------------
#####################################################################
# Reading in doc of IDC10codes and creating codes csv----------------
icd<-gsheet::gsheet2tbl("https://docs.google.com/spreadsheets/d/1hrniE4MIjZKVABg2DMR_tnKOt-SuIdPXYkzszWjQqbA/edit")
# Possibly useful code but not the most important--------------------
#####################################################################
# Reading in doc of IDC10codes and creating codes csv----------------
icd<-gsheet::gsheet2tbl("https://docs.google.com/spreadsheets/d/1hrniE4MIjZKVABg2DMR_tnKOt-SuIdPXYkzszWjQqbA/edit?usp=sharing")
View(icd)
# Possibly useful code but not the most important--------------------
#####################################################################
# Reading in doc of IDC10codes and creating codes csv----------------
icd<-gsheet2tbl("https://docs.google.com/spreadsheets/d/1hrniE4MIjZKVABg2DMR_tnKOt-SuIdPXYkzszWjQqbA/edit?usp=sharing")
?gsheet2tbl
# Possibly useful code but not the most important--------------------
#####################################################################
# Reading in doc of IDC10codes and creating codes csv----------------
icd<-gsheet2tbl("https://docs.google.com/spreadsheets/d/1hrniE4MIjZKVABg2DMR_tnKOt-SuIdPXYkzszWjQqbA/edit?usp=sharing")
View(icd)
icd<-icd %>% mutate(code = substr(icd$diagnosis,1 , 7 )) %>%mutate( astrid = ifelse(str_detect(icd$diagnosis, "[*]"),TRUE,FALSE))
######################## Libraries and Data sets ####################
# June 23rd 2022 | Start of exploration and cleaning!
#####################################################################
library(tidyverse)
icd<-icd %>% mutate(code = substr(icd$diagnosis,1 , 7 )) %>%mutate( astrid = ifelse(str_detect(icd$diagnosis, "[*]"),TRUE,FALSE))
icd$code <- icd$code %>% str_replace_all("[.]","") %>% str_replace_all("[*]","")
View(icd)
# Only run once
write_csv(icd, "codes.csv")
setwd("D:/DataLab/syndemic")
# Only run once
write_csv(icd, "codes.csv")
df<-data.frame()
df<-df %>% mutate(value = c("T123456", "T153","T4034", "T4812390"))
df<-c("T123456", "T153","T4034", "T4812390")
df<-c("T463456", "T4253","T4034", "T4812390")
df<-df %>% filter(substr(value,1,3) %in% swv & !( substr(value,1,1) == "T" & ends_with("5[0:9]")|ends_with("6[0:9]")))
df<-data.frame(value = c("T463456", "T4253","T4034", "T4812390"))
View(df)
df<-df %>% filter(substr(value,1,3) %in% swv & !( substr(value,1,1) == "T" & ends_with("5[0:9]")|ends_with("6[0:9]")))
codes <- read_csv("codes.csv")
# Get codes that tell us with what it should start with
swdf<-codes %>% filter(astrid)
swv<-pull(swdf,code)
df<-df %>% filter(substr(value,1,3) %in% swv & !( substr(value,1,1) == "T" & ends_with("5[0:9]")|ends_with("6[0:9]")))
library(stringr)
md<-read_csv("mdata.csv")
View(md)
df<-data.frame(value = c("T463456", "T425354","T403432", "T483903"))
df<-df %>% filter(substr(value,1,3) %in% swv & !( substr(value,1,1) == "T" & substr(value,6,6)=="5|6"))
View(df)
View(md)
df<-df %>% filter( substr(value,1,1) == "T" & substr(value,6,6)=="5|6")
df<-data.frame(value = c("T463456", "T425364","T403432", "T483903"))
df<-df %>% filter( substr(value,0,1) == "T" & substr(value,5,6)=="5|6")
substr("T463456",6,6)
substr("T463456",1,1)
df<-df %>% filter( substr(value,1,1) == "T" && substr(value,6,6)=="5|6")
df<-data.frame(value = c("T463456", "T425364","T403432", "T483903"))
df<-df %>% filter( substr(value,1,1) == "T" && substr(value,6,6)=="5|6")
df<-df %>% filter( substr(value,1,1) == "T" && substr(value,6,6)=="5")
df<-data.frame(value = c("T463456", "T425364","T403432", "T483903"))
df<-df %>% filter( substr(value,1,1) == "T" && substr(value,6,6)=="5")
df<-data.frame(value = c("T463456", "T425364","T403432", "T483903"))
df<-df %>% filter( substr(value,1,1) == "T" & substr(value,6,6)=="5")
View(df)
df<-data.frame(value = c("T463456", "T425364","T403432", "T483903"))
df<-df %>% filter( substr(value,1,1) == "T" & (substr(value,6,6)=="5"|substr(value,6,6)=="6" ))
df<-data.frame(value = c("T463456", "T425364","T403432", "T483903"))
df<-data.frame(value = c("T463456", "T425364","T403432", "T483903"))
df<-df %>% filter( substr(value,1,1) == "T" &! (substr(value,6,6)=="5"|substr(value,6,6)=="6" ))
View(df)
setwd("D:/DataLab/syndemic")
codes <- read_csv("codes.csv")
######################## Libraries and Data sets ####################
# June 23rd 2022 | Start of exploration and cleaning!
#####################################################################
library(tidyverse)
library(stringr)
library(gsheet)
setwd("D:/DataLab/syndemic")
codes <- read_csv("codes.csv")
#####################################################################
# This data is already filtered for choosen column values!
data<-read_csv("impdata.csv")
#####################################################################
# New Correct way of cleaning data-----------------------------------
# Making all diagnosis into one column!
# For all data change all trainpl into data
trainpl<-data %>%
select( ...1,
Diag1:Diag18
)
trainpl<-trainpl %>% pivot_longer(starts_with("Diag"))
# Get codes that tell us with what it should start with
swdf<-codes %>% filter(astrid)
swv<-pull(swdf,code)
# Look for any person id that has codes that start with any of our start with patterns
swfinal<-trainpl %>%
filter(substr(value,1,3) %in% swv )
swfinal<-swfinal %>% filter( substr(value,1,1) == "T" &! (substr(value,6,6)=="5"|substr(value,6,6)=="6" ))
# Get codes that are fixed and we only want them to match that specific code
fixeddf<-codes %>% filter(!astrid)
fixedv<-pull(fixeddf,code)
# Look for any person id that has code that matches any of our fixed codes
fixedfinal<-trainpl %>% filter(value %in% fixedv)
# Make the patient ids in vectors and join them
swidv<-pull(swfinal,...1)
ffidv<-pull(fixedfinal,...1)
fidv<-c(ffidv, swidv)
fidv<-unique(fidv)
# Get person with ids that we got and care about
cleands<-data %>% filter( ...1 %in% fidv)
View(cleands)
# Clean more, get rid of some more columns
df<-cleands %>% select(-starts_with("HCPC_Rate"),
-X....1.,
-Tot_Charges_Summed,
-Tot_Charges_Analysis,
-Tot_Charges_Recorded,
-Obs_Unit_Flag,
-CostWt,
-starts_with("Proc"),
-Bill_Number,
-Record_Seq_Num,
-Form_Type,
-Accident_Code,
-Admit_Diag_Cd
)
# Clean more, get rid of some more columns
df<-cleands %>% select(-starts_with("HCPC_Rate"),
-Tot_Charges_Summed,
-Tot_Charges_Analysis,
-Tot_Charges_Recorded,
-Obs_Unit_Flag,
-CostWt,
-starts_with("Proc"),
-Bill_Number,
-Record_Seq_Num,
-Form_Type,
-Accident_Code,
-Admit_Diag_Cd
)
write_csv(df, "m_data.csv")
gc()
data<-read_csv("mdata.csv")
ndata<-read_csv("m_data.csv")
View(ndata)
sample(data, 10)
View(sample(data, 10))
View(sample(data$Diag1:Diag18, 10))
View(data)
View(sample(data$Diag1, 10))
View(sample(data[,80:102], 10))
View(sample(data[,80:102], 10))
sample(data[1:300000,], 10)
View(sample(data[1:300000,], 10))
data %>% sample(10)
data %>% sample(Diag1:Diag18,10)
data %>% sample(Diag1,10)
rand_df <- data[sample(nrow(data), size=10), ]
View(rand_df)
View(data)
######################## Libraries and Data sets ####################
# June 23rd 2022 | Start of exploration and cleaning!
#####################################################################
library(tidyverse)
gc()
######################## Libraries and Data sets ####################
# June 23rd 2022 | Start of exploration and cleaning!
#####################################################################
library(tidyverse)
library(stringr)
library(gsheet)
setwd("D:/DataLab/syndemic")
codes <- read_csv("codes.csv")
#####################################################################
# This data is already filtered for choosen column values!
data<-read_csv("impdata.csv")
#####################################################################
# New Correct way of cleaning data-----------------------------------
# Making all diagnosis into one column!
# For all data change all trainpl into data
trainpl<-data %>%
select( ...1,
Diag1:Diag18
)
trainpl<-trainpl %>% pivot_longer(starts_with("Diag"))
# Get codes that tell us with what it should start with
swdf<-codes %>% filter(astrid)
swv<-pull(swdf,code)
# Look for any person id that has codes that start with any of our start with patterns
swfinal<-trainpl %>%
filter(substr(value,1,3) %in% swv )
swfinalup<-swfinal %>% filter( !(substr(value,1,1) == "T" & (substr(value,6,6)=="5"|substr(value,6,6)=="6" )))
swfinal<-swfinal %>% filter( !(substr(value,1,1) == "T" & (substr(value,6,6)=="5"|substr(value,6,6)=="6" )))
rm(swfinalup)
# Get codes that are fixed and we only want them to match that specific code
fixeddf<-codes %>% filter(!astrid)
fixedv<-pull(fixeddf,code)
# Look for any person id that has code that matches any of our fixed codes
fixedfinal<-trainpl %>% filter(value %in% fixedv)
# Make the patient ids in vectors and join them
swidv<-pull(swfinal,...1)
ffidv<-pull(fixedfinal,...1)
fidv<-c(ffidv, swidv)
fidv<-unique(fidv)
# Get person with ids that we got and care about
cleands<-data %>% filter( ...1 %in% fidv)
# Clean more, get rid of some more columns
cleands<-cleands %>% select(-starts_with("HCPC_Rate"),
-Tot_Charges_Summed,
-Tot_Charges_Analysis,
-Tot_Charges_Recorded,
-Obs_Unit_Flag,
-CostWt,
-starts_with("Proc"),
-Bill_Number,
-Record_Seq_Num,
-Form_Type,
-Accident_Code,
-Admit_Diag_Cd
)
write_csv(cleands, "m_data.csv")
gc()
data<-read_csv("m_data.csv")
View(data)
trainpl<-data %>%
select( ...1,
Diag1:Diag18
)
View(trainpl)
trainpl<-trainpl %>% pivot_longer(starts_with("Diag"))
View(trainpl)
code<-read_csv("codes.csv")
View(code)
sudcodes<-codes %>% filter(sud)
sudcodes<-code %>% filter(sud)
View(sudcodes)
View(sudcodes)
View(sudcodes)
# Get codes that tell us with what it should start with
swdf<-sudcodes %>% filter(astrid)
View(swdf)
swv<-pull(swdf,code)
# Look for any person id that has codes that start with any of our start with patterns
swfinal<-trainpl %>%
filter(substr(value,1,3) %in% swv )
View(swfinal)
swfinal<-swfinal %>% filter( !(substr(value,1,1) == "T" & (substr(value,6,6)=="5"|substr(value,6,6)=="6" )))
View(swfinal)
View(sudcodes)
# Get codes that are fixed and we only want them to match that specific code
fixeddf<-sudcodes %>% filter(!astrid)
View(fixeddf)
fixedv<-pull(fixeddf,code)
# Look for any person id that has code that matches any of our fixed codes
fixedfinal<-trainpl %>% filter(value %in% fixedv)
View(fixedfinal)
# Make the patient ids in vectors and join them
swidv<-pull(swfinal,...1)
ffidv<-pull(fixedfinal,...1)
fidv<-c(ffidv, swidv)
fidv<-unique(fidv)
# Get person with ids that we got and care about
suddata<-data %>% filter( ...1 %in% fidv)
View(suddata)
View(sudcodes)
View(code)
View(code)
codesbutsud<-code %>% filter(!sud)
View(codesbutsud)
#####################################################################
# But suds--------------
# Filtering for codes we want
trainpl<-data %>%
select( ...1,
Diag1:Diag18
)
trainpl<-trainpl %>% pivot_longer(starts_with("Diag"))
codesbs<-code %>% filter(!sud)
# Get codes that tell us with what it should start with
swdf<-codesbs %>% filter(astrid)
swv<-pull(swdf,code)
# Look for any person id that has codes that start with any of our start with patterns
swfinal<-trainpl %>%
filter(substr(value,1,3) %in% swv )
swfinal<-swfinal %>% filter( !(substr(value,1,1) == "T" & (substr(value,6,6)=="5"|substr(value,6,6)=="6" )))
# Get codes that are fixed and we only want them to match that specific code
fixeddf<-codesbs %>% filter(!astrid)
# Look for any person id that has codes that start with any of our start with patterns
swfinal<-trainpl %>%
filter(substr(value,1,3) %in% swv )
swfinal<-swfinal %>% filter( !(substr(value,1,1) == "T" & (substr(value,6,6)=="5"|substr(value,6,6)=="6" )))
# Get codes that are fixed and we only want them to match that specific code
fixeddf<-codesbs %>% filter(!astrid)
fixedv<-pull(fixeddf,code)
# Look for any person id that has code that matches any of our fixed codes
fixedfinal<-trainpl %>% filter(value %in% fixedv)
# Make the patient ids in vectors and join them
swidv<-pull(swfinal,...1)
ffidv<-pull(fixedfinal,...1)
fidv<-c(ffidv, swidv)
fidv<-unique(fidv)
# Get person with ids that we got and care about
databs<-data %>% filter( ...1 %in% fidv)
View(databs)
######################## Libraries and Data sets ####################
# June 23rd 2022 | Start of exploration and cleaning!
#####################################################################
library(tidyverse)
gc()
######################## Libraries and Data sets ####################
# June 23rd 2022 | Start of exploration and cleaning!
#####################################################################
library(tidyverse)
library(stringr)
library(gsheet)
setwd("D:/DataLab/syndemic")
codes <- read_csv("codes.csv")
View(codes)
#####################################################################
# This data is already filtered for choosen column values!
data<-read_csv("impdata.csv")
#####################################################################
# New Correct way of cleaning data-----------------------------------
# Making all diagnosis into one column!
# For all data change all trainpl into data
trainpl<-data %>%
select( ...1,
Diag1:Diag18
)
trainpl<-trainpl %>% pivot_longer(starts_with("Diag"))
# Get codes that tell us with what it should start with
codes<-codes %>% filter(sud)
swdf<-codes %>% filter(astrid)
swv<-pull(swdf,code)
# Look for any person id that has codes that start with any of our start with patterns
swfinal<-trainpl %>%
filter(substr(value,1,3) %in% swv )
swfinal<-swfinal %>% filter( !(substr(value,1,1) == "T" & (substr(value,6,6)=="5"|substr(value,6,6)=="6" )))
# Get codes that are fixed and we only want them to match that specific code
fixeddf<-codes %>% filter(!astrid)
fixedv<-pull(fixeddf,code)
# Look for any person id that has code that matches any of our fixed codes
fixedfinal<-trainpl %>% filter(value %in% fixedv)
# Make the patient ids in vectors and join them
swidv<-pull(swfinal,...1)
ffidv<-pull(fixedfinal,...1)
fidv<-c(ffidv, swidv)
fidv<-unique(fidv)
# Get person with ids that we got and care about
cleands<-data %>% filter( ...1 %in% fidv)
# Clean more, get rid of some more columns
cleands<-cleands %>% select(-starts_with("HCPC_Rate"),
-Tot_Charges_Summed,
-Tot_Charges_Analysis,
-Tot_Charges_Recorded,
-Obs_Unit_Flag,
-CostWt,
-starts_with("Proc"),
-Bill_Number,
-Record_Seq_Num,
-Form_Type,
-Accident_Code,
-Admit_Diag_Cd
)
View(cleands)
gc()
# Add boolean values
cleands<-cleands %>% mutate( sud = TRUE)
codes <- read_csv("codes.csv")
endocodes<-codes %>% filter(endo)
View(endocodes)
View(endocodes)
# Add boolean value for ENDO
# Pull codes that are just endo
endocodes<-codes %>% filter(endo) %>% pull(code)
# Add boolean value for ENDO
trainple<-cleands %>%
select( ...1,
Diag1:Diag18
)
trainple<-trainple %>% pivot_longer(starts_with("Diag"))
# search for those in data cleands where they have an endo code
endoids<-trainple %>% filter(value %in% endocodes)
# search for those in data cleands where they have an endo code and get there ids
endoids<-trainple %>% filter(value %in% endocodes) %>% pull(...1)
# search for those in data cleands where they have an endo code and get there ids
endoids<-trainple %>% filter(value %in% endocodes) %>% pull(...1) %>% unique()
# Add boolean column to cleands
train<-cleands %>% mutate( endo = ifelse(...1 %in% endoids, TRUE, FALSE ))
View(train)
# Add boolean column to cleands
cleands<-cleands %>% mutate( endo = ifelse(...1 %in% endoids, TRUE, FALSE ))
rm(train)
# Add boolean value for SSTVI----------------------------------------
trainpls<-cleands %>%
select( ...1,
Diag1:Diag18
)
trainpls<-trainpls %>% pivot_longer(starts_with("Diag"))
View(codes)
# Pull codes that are just endo into vector
sstvicodes<-codes %>% filter(sstvi) %>% pull(code)
# search for those in data cleands where they have an endo code and get there ids
sstviids<-trainpls %>% filter(value %in% sstvicodes) %>% pull(...1) %>% unique()
# Add boolean column to cleands
cleands<-cleands %>% mutate( sstvi = ifelse(...1 %in% sstviids, TRUE, FALSE ))
View(cleands)
